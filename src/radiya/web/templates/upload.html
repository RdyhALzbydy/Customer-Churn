{% extends "base.html" %}

{% block title %}رفع البيانات - رضية{% endblock %}

{% block content %}
<section class="upload-section">
    <div class="upload-container">
        <h1 class="section-title">
            <i class="fas fa-cloud-upload-alt"></i>
            رفع ملف البيانات
        </h1>
        
        <div class="upload-info">
            <div class="info-card">
                <h3>متطلبات الملف:</h3>
                <ul>
                    <li><i class="fas fa-check"></i> نوع الملف: JSON أو CSV</li>
                    <li><i class="fas fa-check"></i> الحد الأقصى للحجم: 129 MB</li>
                    <li><i class="fas fa-check"></i> بيانات Sparkify مع الأعمدة المطلوبة</li>
                    <li><i class="fas fa-check"></i> يجب أن يحتوي على userId, sessionId, page, ts, level</li>
                </ul>
            </div>
        </div>

        <!-- Upload Form -->
        <div class="upload-form">
            <form id="upload-form" enctype="multipart/form-data">
                <div class="file-drop-zone" id="drop-zone">
                    <div class="drop-content">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>اسحب الملف هنا أو اضغط للاختيار</h3>
                        <p>JSON, CSV - حتى 129 MB</p>
                        <input type="file" id="file-input" name="file" accept=".json,.csv" hidden>
                        <button type="button" class="btn btn-primary" onclick="document.getElementById('file-input').click()">
                            <i class="fas fa-folder-open"></i>
                            اختر الملف
                        </button>
                    </div>
                </div>
                
                <div class="selected-file" id="selected-file" style="display: none;">
                    <div class="file-info">
                        <i class="fas fa-file-alt"></i>
                        <div class="file-details">
                            <div class="file-name" id="file-name"></div>
                            <div class="file-size" id="file-size"></div>
                        </div>
                        <button type="button" class="btn btn-sm btn-danger" onclick="removeFile()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <div class="upload-actions">
                    <button type="submit" class="btn btn-success" id="upload-btn" disabled>
                        <i class="fas fa-upload"></i>
                        رفع وتحليل البيانات
                    </button>
                </div>
            </form>
        </div>

        <!-- Progress -->
        <div class="upload-progress" id="upload-progress" style="display: none;">
            <div class="progress-header">
                <h3><i class="fas fa-cog fa-spin"></i> جاري المعالجة...</h3>
                <span class="progress-text" id="progress-text">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-status" id="progress-status">تحضير البيانات...</div>
        </div>

        <!-- Results Preview -->
        <div class="results-preview" id="results-preview" style="display: none;">
            <h3><i class="fas fa-chart-line"></i> ملخص النتائج</h3>
            <div class="results-grid" id="results-grid"></div>
            <div class="results-actions">
                <a href="#" class="btn btn-primary" id="view-full-results">
                    <i class="fas fa-eye"></i>
                    عرض النتائج الكاملة
                </a>
                <button type="button" class="btn btn-secondary" onclick="resetUpload()">
                    <i class="fas fa-redo"></i>
                    رفع ملف آخر
                </button>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/upload.css">
{% endblock %}

{% block extra_js %}
<script src="/static/js/upload.js"></script>
{% endblock %}